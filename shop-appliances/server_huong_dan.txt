üìã H∆Ø·ªöNG D·∫™N DEPLOY PROJECT M·ªöI L√äN SERVER

üîß Y√äU C·∫¶U BAN ƒê·∫¶U
- Server ƒë√£ c√≥: Nginx + PHP 8.3 + MySQL
- Domain ƒë√£ tr·ªè v·ªÅ IP: 103.104.118.142
- Source code ƒë√£ s·∫µn s√†ng

===============================================

üìÅ B∆Ø·ªöC 1: T·∫†O TH·ª¶ M·ª§C PROJECT

# T·∫°o th∆∞ m·ª•c cho project m·ªõi
sudo mkdir -p /var/www/sites/TEN_PROJECT

# Ph√¢n quy·ªÅn
sudo chown -R www-data:www-data /var/www/sites/TEN_PROJECT
sudo chmod -R 755 /var/www/sites/TEN_PROJECT

===============================================

üì§ B∆Ø·ªöC 2: UPLOAD SOURCE CODE

## C√°ch 1: D√πng Git
cd /var/www/sites/TEN_PROJECT
sudo git clone https://github.com/USERNAME/REPO.git .
sudo chown -R www-data:www-data /var/www/sites/TEN_PROJECT

## C√°ch 2: Upload qua FTP/SCP
# Upload source v√†o /var/www/sites/TEN_PROJECT
# Sau ƒë√≥ ph√¢n quy·ªÅn:
sudo chown -R www-data:www-data /var/www/sites/TEN_PROJECT
sudo chmod -R 755 /var/www/sites/TEN_PROJECT

===============================================

üåê B∆Ø·ªöC 3: C·∫§U H√åNH NGINX

## T·∫°o file c·∫•u h√¨nh
sudo nano /etc/nginx/sites-available/TEN_PROJECT

## N·ªôi dung file (cho Laravel):
server {
    listen 80;
    server_name DOMAIN.COM www.DOMAIN.COM;
    root /var/www/sites/TEN_PROJECT/public;
    index index.php index.html index.htm;

    # Handle Laravel routes
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Handle PHP files
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    # Static files caching
    location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # Security
    location ~ /\. {
        deny all;
    }
    
    location ~* \.(env|log|htaccess)$ {
        deny all;
    }
}

## N·ªôi dung file (cho PHP thu·∫ßn):
server {
    listen 80;
    server_name DOMAIN.COM www.DOMAIN.COM;
    root /var/www/sites/TEN_PROJECT;
    index index.php index.html index.htm;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\. {
        deny all;
    }
}

## Enable site
# Enable site
sudo ln -s /etc/nginx/sites-available/TEN_PROJECT /etc/nginx/sites-enabled/

# Test c·∫•u h√¨nh
sudo nginx -t

# Restart nginx
sudo systemctl restart nginx

===============================================

üóÑÔ∏è B∆Ø·ªöC 4: SETUP DATABASE (n·∫øu c·∫ßn)

# V√†o MySQL
sudo mysql

# T·∫°o database
CREATE DATABASE ten_database;

# C·∫•p quy·ªÅn cho user shop_user (ƒë√£ c√≥ s·∫µn)
GRANT ALL PRIVILEGES ON ten_database.* TO 'shop_user'@'%';
GRANT ALL PRIVILEGES ON ten_database.* TO 'shop_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;

TH√îNG TIN K·∫æT N·ªêI DATABASE:
- Host: 127.0.0.1
- User: shop_user
- Password: password123
- Database: ten_database

===============================================

‚öôÔ∏è B∆Ø·ªöC 5: C·∫§U H√åNH LARAVEL (n·∫øu l√† Laravel)

## C√†i ƒë·∫∑t dependencies
cd /var/www/sites/TEN_PROJECT
sudo -u www-data composer install --optimize-autoloader --no-dev

## C·∫•u h√¨nh .env
# Copy .env
sudo -u www-data cp .env.example .env

# S·ª≠a .env
sudo nano .env

N·ªòI DUNG .ENV C·∫¶N S·ª¨A:
APP_NAME="T√™n Project"
APP_ENV=production
APP_DEBUG=false
APP_URL=http://DOMAIN.COM

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=ten_database
DB_USERNAME=shop_user
DB_PASSWORD=password123

## Generate key v√† setup
# Generate key
sudo -u www-data php artisan key:generate

# Storage link
sudo -u www-data php artisan storage:link

# Cache config
sudo -u www-data php artisan config:cache
sudo -u www-data php artisan route:cache
sudo -u www-data php artisan view:cache

# Migration (n·∫øu c·∫ßn)
sudo -u www-data php artisan migrate

# Ph√¢n quy·ªÅn storage
sudo chmod -R 775 /var/www/sites/TEN_PROJECT/storage
sudo chmod -R 775 /var/www/sites/TEN_PROJECT/bootstrap/cache

===============================================

üîí B∆Ø·ªöC 6: C√ÄI SSL (HTTPS)

# C√†i Certbot (n·∫øu ch∆∞a c√≥)
sudo apt install certbot python3-certbot-nginx

# Issue SSL certificate
sudo certbot --nginx -d DOMAIN.COM -d www.DOMAIN.COM

# Auto-renew (ƒë√£ t·ª± ƒë·ªông setup)
sudo certbot renew --dry-run

===============================================

‚úÖ B∆Ø·ªöC 7: KI·ªÇM TRA HO·∫†T ƒê·ªòNG

# Test truy c·∫≠p
curl -I http://DOMAIN.COM
curl -I https://DOMAIN.COM

# Ki·ªÉm tra SSL
curl -I https://DOMAIN.COM

# Monitor log
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

===============================================

üîÑ B∆Ø·ªöC 8: SCRIPT DEPLOY T·ª∞ ƒê·ªòNG (Optional)

## T·∫°o file deploy script:
sudo nano /var/www/sites/TEN_PROJECT/deploy.sh

N·ªòI DUNG FILE DEPLOY.SH:
#!/bin/bash

cd /var/www/sites/TEN_PROJECT

echo "üöÄ Starting deployment..."

# Pull latest code
sudo -u www-data git pull origin main

# Install dependencies
sudo -u www-data composer install --optimize-autoloader --no-dev

# Laravel optimizations
sudo -u www-data php artisan config:cache
sudo -u www-data php artisan route:cache  
sudo -u www-data php artisan view:cache

# Run migrations
sudo -u www-data php artisan migrate --force

# Fix permissions
sudo chown -R www-data:www-data /var/www/sites/TEN_PROJECT
sudo chmod -R 775 /var/www/sites/TEN_PROJECT/storage
sudo chmod -R 775 /var/www/sites/TEN_PROJECT/bootstrap/cache

echo "‚úÖ Deployment completed!"

## Ph√¢n quy·ªÅn v√† ch·∫°y script
# Ph√¢n quy·ªÅn script
sudo chmod +x /var/www/sites/TEN_PROJECT/deploy.sh

# Ch·∫°y deploy
sudo /var/www/sites/TEN_PROJECT/deploy.sh

===============================================

üìã CHECKLIST HO√ÄN TH√ÄNH

- [ ] T·∫°o th∆∞ m·ª•c project
- [ ] Upload source code
- [ ] C·∫•u h√¨nh nginx
- [ ] T·∫°o database
- [ ] C·∫•u h√¨nh .env (Laravel)
- [ ] Ch·∫°y migration (Laravel)
- [ ] C√†i SSL certificate
- [ ] Test website ho·∫°t ƒë·ªông
- [ ] Setup deploy script

===============================================

üîß TROUBLESHOOTING

## L·ªói 404 Not Found
# Ki·ªÉm tra nginx config
sudo nginx -T | grep -A 10 "server_name DOMAIN.COM"

# Ki·ªÉm tra root path
ls -la /var/www/sites/TEN_PROJECT/

## L·ªói 500 Internal Server Error
# Xem log l·ªói
sudo tail -f /var/log/nginx/error.log

# Ki·ªÉm tra quy·ªÅn file
sudo chown -R www-data:www-data /var/www/sites/TEN_PROJECT
sudo chmod -R 775 /var/www/sites/TEN_PROJECT/storage

## L·ªói Database Connection
# Test k·∫øt n·ªëi database
mysql -h 127.0.0.1 -u shop_user -p ten_database

# Ki·ªÉm tra .env file
cat /var/www/sites/TEN_PROJECT/.env | grep DB_

===============================================

üéâ HO√ÄN TH√ÄNH! Website ƒë√£ s·∫µn s√†ng truy c·∫≠p t·∫°i https://DOMAIN.COM

===============================================

üìù TH√îNG TIN SERVER HI·ªÜN T·∫†I:

IP Server: 103.104.118.142
Nginx: 1.24.0
PHP: 8.3.6
MySQL: ƒê√£ c√†i ƒë·∫∑t

User Database c√≥ s·∫µn:
- User: shop_user
- Password: password123
- Quy·ªÅn: Admin to√†n b·ªô MySQL

Firewall ƒë√£ m·ªü:
- Port 22 (SSH)
- Port 80 (HTTP)
- Port 443 (HTTPS)
- Port 3306 (MySQL)
- Port 8080 (Test)

Th∆∞ m·ª•c ch√≠nh: /var/www/sites/
Project hi·ªán t·∫°i: 
- Shop Appliances: http://103.104.118.142/shop-appliances/
- Tin T·ª©c: http://103.104.118.142:8080/

===============================================

üìû LI√äN H·ªÜ H·ªñ TR·ª¢:
Khi g·∫∑p v·∫•n ƒë·ªÅ, ki·ªÉm tra:
1. Log nginx: /var/log/nginx/error.log
2. Log PHP: /var/log/php8.3-fpm.log
3. Quy·ªÅn file: ls -la /var/www/sites/TEN_PROJECT
4. Database connection: mysql -h 127.0.0.1 -u shop_user -p

=============================================== 